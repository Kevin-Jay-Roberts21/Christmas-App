{% extends "base.html" %}
{% block content %}
<h2>My Groups</h2>

<section class="card">
  <div class="card-header">
    <h3>Invitations for you</h3>
  </div>

  {% if invites and invites|length > 0 %}
    <ul class="list">
      {% for mem in invites %}
        {% set g = inv_group_map.get(mem.group_id) %}
        <li>
          <strong>{{ g.name if g else ('Group #' ~ mem.group_id) }}</strong>
          <form method="post" action="/groups/{{ mem.group_id }}/accept_invite" style="display:inline;margin-left:8px;">
            <label>Choose a list to share:
              <select name="selected_list_id" required>
                {% for gl in my_lists %}
                  <option value="{{ gl.id }}">{{ gl.name }}</option>
                {% endfor %}
              </select>
            </label>
            <button class="btn">Accept</button>
          </form>
          <form method="post" action="/groups/{{ mem.group_id }}/decline_invite" style="display:inline;margin-left:6px;">
            <button class="btn btn-outline">Decline</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="muted">No invitations at the moment.</div>
  {% endif %}
</section>

<section class="card" style="margin-top:1rem;">
  <div class="card-header">
    <h3>You're in</h3>
  </div>
  {% if groups and groups|length > 0 %}
    <ul class="list">
      {% for g in groups %}
        {% set mem = mem_map.get(g.id) %}
        <li>
          {% if mem and (not mem.is_approved) and (not mem.is_denied) and (not mem.is_invite) %}
            <span>{{ g.name }}</span> <span class="tag">Pending</span>
          {% elif mem and mem.is_denied %}
            <span>{{ g.name }}</span> <span class="tag" style="background:#fee2e2;color:#991b1b;">Denied</span>
            <form method="post" action="/groups/{{ g.id }}/remove_denied" style="display:inline;margin-left:6px;">
              <button class="btn" title="Remove">âœ•</button>
            </form>
          {% else %}
            <a href="/groups/{{ g.id }}">{{ g.name }}</a>
            {% if g.leader_id == me.id %}<span class="tag">Leader</span>{% endif %}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="muted">You haven't joined any groups yet.</div>
  {% endif %}
</section>
{% endblock %}
