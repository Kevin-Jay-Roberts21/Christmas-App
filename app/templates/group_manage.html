{% extends "base.html" %}
{% block content %}
<h2>Manage "{{ group.name }}"</h2>

{% if error %}
  <p style="padding:.5rem; background:#fef2f2; border:1px solid #fca5a5; border-radius:.5rem;">
    {{ error }}
  </p>
{% endif %}
{% if info %}
  <p style="padding:.5rem; background:#ecfeff; border:1px solid #06b6d4; border-radius:.5rem;">
    {{ info }}
  </p>
{% endif %}

<h3>Approved members</h3>
<ul>
  {% for mem, u, gl in approved %}
    <li>
      {{ u.username }} {% if u.id == group.leader_id %}(leader){% endif %}
      {% if gl %}— list "<strong>{{ gl.name }}</strong>"{% endif %}
      {% if u.id != group.leader_id %}
        <form method="post" action="/groups/{{ group.id }}/kick/{{ u.id }}" style="display:inline;margin-left:6px;">
          <button class="btn btn-outline" title="Remove from group" onclick="return confirm('Remove {{ u.username }} from this group?');">Remove</button>
        </form>
      {% endif %}
    </li>
  {% else %}
    <li><em>No approved members yet.</em></li>
  {% endfor %}
</ul>

<h3>Pending requests</h3>
<ul>
  {% for mem, u, gl in pending %}
    <li>
      {{ u.username }}
      {% if gl %}— wants to show list "<strong>{{ gl.name }}</strong>"{% endif %}

      <form method="post" action="/groups/{{ group.id }}/approve" style="display:inline">
        <input type="hidden" name="membership_id" value="{{ mem.id }}">
        <button type="submit">Approve</button>
      </form>

      <form method="post" action="/groups/{{ group.id }}/deny" style="display:inline; margin-left:6px;">
        <input type="hidden" name="membership_id" value="{{ mem.id }}">
        <button type="submit">Deny</button>
      </form>
    </li>
  {% else %}
    <li><em>No pending requests.</em></li>
  {% endfor %}
</ul>

<h3>Invite user</h3>
<form method="post" action="/groups/{{ group.id }}/invite" class="inline-form">
  <input type="text" name="invitee" placeholder="username or email" required>
  <button type="submit">Invite</button>
</form>

{% if invited and invited|length > 0 %}
  <h3>Invited users (awaiting acceptance)</h3>
  <ul>
    {% for mem, u, gl in invited %}
      <li>{{ u.username }}</li>
    {% endfor %}
  </ul>
{% endif %}

<p><a href="/groups/{{ group.id }}">Back to group</a></p>
{% endblock %}